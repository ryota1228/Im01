<div class="dashboard-wrapper">
  <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

  <div class="home-grid">
    <!-- å·¦ã‚«ãƒ©ãƒ  -->
    <div class="home-main">
      <div class="section">
        <h2>ä»Šæ—¥ãŒæœŸé™ã®ã‚¿ã‚¹ã‚¯</h2><div>ç¾åœ¨æ—¥æ™‚ï¼š{{ currentTime | date: 'MM/dd HH:mm:ss' }}</div>
        <div class="section-scrollable">
        <div *ngIf="isLoading">èª­ã¿è¾¼ã¿ä¸­...</div>
        <ul *ngIf="!isLoading && todaysTasks.length > 0">
          <li *ngFor="let task of todaysTasks" (click)="openTask(task)">
            {{ task.title }}ï¼ˆé€²æ—ç‡ï¼š{{ task.progress }}%ï¼‰
          </li>
        </ul>
        <p *ngIf="!isLoading && todaysTasks.length === 0">ä»Šæ—¥æœŸé™ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        </div>
      </div>

      <div class="section">
        <h2>æœŸé™è¶…éã‚¿ã‚¹ã‚¯</h2>
        <div class="section-scrollable">
        <ul *ngIf="delayedTasks.length > 0">
          <li *ngFor="let task of delayedTasks" (click)="openTask(task)">
            {{ task.title }}ï¼ˆæœŸé™: {{ task.dueDate | date: 'MM/dd' }}ï¼‰
          </li>
        </ul>
        <p *ngIf="delayedTasks.length === 0">æœŸé™è¶…éä¸­ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        </div>
      </div>

      <div class="section">
        <h2>å‚åŠ ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h2>
        <div class="section-scrollable">
        <ul>
          <li *ngFor="let project of sortedProjects" (click)="goToProject(project.id)">
            <strong>{{ project.title }}</strong>
            ï¼ˆæœŸé™: {{ project.dueDate | date: 'MM/dd' }} / é…å»¶: {{ project.delayedCount }}ä»¶ï¼‰
            <button
              class="pin-button"
              [class.pinned]="project.pinned"
              (click)="togglePin(project.id); $event.stopPropagation();"
            >
              <mat-icon>push_pin</mat-icon>{{ project.pinned ? 'è§£é™¤' : 'ä¸Šéƒ¨ã«å›ºå®š' }}
            </button>
          </li>
        </ul>
        
        </div>
      </div>

      <div class="section">
        <h2>ä»Šé€±ã®ã‚¿ã‚¹ã‚¯</h2>
        <div class="section-scrollable">
        <app-calendar-view
          [mode]="'week'"
          [embedded]="true"
          [currentDate]="currentTime"
          [userId]="uid">
        </app-calendar-view>
        </div>
      </div>
    </div>

    <!-- å³ã‚«ãƒ©ãƒ  -->
    <div class="home-side">
      <div class="notification-preview">
        <h2>é€šçŸ¥</h2>
        <div class="notification-filters">
          <label>
            <input type="checkbox" [checked]="showUnreadOnly" (change)="toggleUnreadOnly($event)"> æœªèª­ã®ã¿
          </label>
        
          <div class="filter-group">
            <div class="filter-group-title">é€šçŸ¥ã®ç¨®åˆ¥</div>
            <label><input type="checkbox" (change)="toggleType('new')" [checked]="selectedTypes.includes('new')"> æ–°è¦</label>
            <label><input type="checkbox" (change)="toggleType('update')" [checked]="selectedTypes.includes('update')"> æ›´æ–°</label>
            <label><input type="checkbox" (change)="toggleType('deadline')" [checked]="selectedTypes.includes('deadline')"> æœŸæ—¥</label>
          </div>
        </div>

        
        <div class="section-scrollable">
        <div *ngIf="notifications.length === 0">é€šçŸ¥ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>

        <ul>
          <li *ngFor="let n of filteredNotifications" (click)="onClickNotification(n)">            
            <span *ngIf="!n.isRead">ğŸŸ </span><strong>{{ getTypeLabel(n.type) }}</strong>{{ n.taskName }}<span class="timestamp">ï¼ˆ{{ n.timestamp.toDate() | date: 'yyyy/MM/dd HH:mm' }}ï¼‰</span>
          </li>
        </ul>
        




        </div>
      </div>

      <div class="section">
        <h2>ãƒãƒ£ãƒƒãƒˆé€šçŸ¥</h2>
        <div class="section-scrollable">
          <ul>
              <li
              *ngFor="let notif of chatNotifications"
              [class.unread]="!notif.isRead"
              (click)="onClickChatNotification(notif)"
            >
              <span *ngIf="!notif.isRead">ğŸŸ </span>
              <strong>{{ notif.message }}</strong>ï¼ˆ{{ notif.fromName }}/{{ notif.createdAt | date:'shortTime' }}ï¼‰
            </li>
          </ul>
        </div>
      </div>
      
      


    </div>
  </div>
</div>
